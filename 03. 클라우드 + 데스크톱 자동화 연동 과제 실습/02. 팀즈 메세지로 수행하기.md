# 게시물 등록 감지하여 클라우드 흐름 실행

#### Teams에서 키워드가 포함된 게시물 등록 확인되면, 클라우드 흐름이 실행됨.
#### 클라우드 흐름 내에서 데스크톱 흐름에 검색 키워드 전달 및 Teams로 완료 메시지 발송하는 Cloud Flow 만들기

<br> 

1. 기존 트리거 (Manually trigger a flow) 삭제 후, Add a trigger 클릭

2. 트리거 목록에서 **When Keywords are mentioned** 검색 후 선택하여 트리거 추가

```
When Keywords are mentioned
```
<br>

![image](https://github.com/user-attachments/assets/584674e5-df7f-4454-9b1b-4044f442d990)

<br>
<br>

3. When Keywords are mentioned (키워드가 멘션될 때) 클릭 후, 왼편 패널의 각 항목별 값 입력
```
- Keywords to search for: news
- Message type: Channel
- Channels: General
- Team: MSFT
```

![img4](https://github.com/user-attachments/assets/4c46bd81-8df6-4198-a161-83a497f18c19)

<br>
<br>

![image](https://github.com/user-attachments/assets/b746f7ad-55db-40df-a927-79dbd8cebdbd)

<br>
<br>

### 클라우드 흐름(Cloud Flow) 내에서 데스크톱 흐름 호출 및 Teams 메시지 발송 action 추가하기

1. 트리거 하단 **+** -> **Add an action** 클릭
   
![image](https://github.com/user-attachments/assets/c7130414-e086-4cbf-b1c0-27f5fdf339b7)

<br>

2. Apply to each 검색 후 추가

![image](https://github.com/user-attachments/assets/f3409b23-194c-4560-bd8e-fb79b5ec2d16)

<br>

3. 우측 fx 클릭

![image](https://github.com/user-attachments/assets/12d9a90d-f82c-4c89-b6c3-f39ab5486923)

<br>

4.Dynamic content -> See more 클릭

![image](https://github.com/user-attachments/assets/aabc3ead-3b00-45be-bc93-b88d60139dd1)

<br>

5. body/value 선택 후 Add 클릭

![image](https://github.com/user-attachments/assets/fe21e784-ebcd-4386-8c6b-5fbe9a3f4755)

<br>

6. 하단에 **Get message details action** 추가 후, 다음과 같이 설정

![image](https://github.com/user-attachments/assets/517b82fc-fbd2-48c8-a6af-6e7b68b16a73)

<br>

![image](https://github.com/user-attachments/assets/d3167b39-f7f5-4052-b104-ca45d529a1af)

<br>

7. **Contidion** action 추가 후, 다음과 같이 설정

![image](https://github.com/user-attachments/assets/cfca05f9-91fd-4cf9-8f69-447399642bba)

<br>

![image](https://github.com/user-attachments/assets/ca53bfbe-7259-40ac-a712-9b79dd7b8752)

<br>

8. True 하단에 **Run a flow built with Power Automate for desktop (데스크톱용 Power Automate로 빌드된 흐름 실행)** action 추가 후, 다음과 같이 설정

<br>

- 가져온 본문 내용을 콜론(:) 문자를 기준으로 분할 후, 콜론(:) 뒷 부분을 데스크톱 흐름에 전달하기 위한 명령어 입력
```
last(split(outputs('Get_message_details')?['body/body/plainTextContent'], ':'))
```
### [설명]
```
Get_message_details라는 액션의 출력값에서<br>
body/body/plainTextContent (본문의 텍스트 내용) 을 가져와서,
문자열을 콜론(:) 문자를 기준으로 분할하여 배열로 반환 후,
배열의 마지막 항목을 가져옵니다.
```

![img2](https://github.com/user-attachments/assets/50f411ad-21b6-45bf-9290-62ff0ff1fb08)

![image](https://github.com/user-attachments/assets/4eb8c4c2-fffc-4e95-997a-f6d0616ca366)

<br>

9. 기존 action을 새롭게 추가한 desktop flow 호출 action 하단으로 이동

![image](https://github.com/user-attachments/assets/b12b2549-7ff8-492f-95e5-9369967275fc)

<br>

10. **Reply with a message in a channel action** 추가 후, 다음과 같이 설정

![image](https://github.com/user-attachments/assets/82382f57-b0a8-4327-b8cd-2d7f78cb8717)

<br>
<br>

# 클라우드 흐름 작업 순서 (sample)

1. Teams의 **general** 채널에 **news**라는 키워드를 본문에 포함한 게시물 등록 감지 
<br>
<br>

![image](https://github.com/user-attachments/assets/f896feff-7775-4319-8f58-42123dfef24b)

<br>

2. trigger를 통해 Cloud Flow실행 -> 네이버 뉴스 검색 후 완료 메시지 댓글 입력

![image](https://github.com/user-attachments/assets/a9f4345b-782c-466f-b0d8-96d082d87d2c)
<br>
<br>
<br>
<br>
<br>

