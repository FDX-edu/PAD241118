# 팀즈 채널에서 클라우드 흐름 실행하고 답변 받기

#### Teams 채널에서 키워드가 포함된 게시물 등록 확인되면, 클라우드 흐름이 실행됨.
#### 클라우드 흐름 내에서 데스크톱 흐름에 검색 키워드 전달 및 Teams로 완료 메시지 발송하는 Cloud Flow 만들기

<br> 

# 1. 트리거 변경

1. 기존 트리거 (Manually trigger a flow) 삭제 후, Add a trigger 클릭

   ![image](https://github.com/user-attachments/assets/8f6c8864-ade7-440e-a48b-27ec7cdfb40f)


2. 트리거 목록에서 **Microsoft Teams** 트리거 중에서 **키워드가 멘션될때**를  선택하여 트리거 추가

   ![image](https://github.com/user-attachments/assets/5a7127f1-0f47-4ee7-ae17-d29ea225b62b)

3. When Keywords are mentioned (키워드가 멘션될 때) 클릭 후, 왼편 패널의 각 항목별 값 입력
 
   - 검색할 키워드 : **news:** 를 입력 
   - 메세지 유형 : **Channel** 을 선택
   - 채널 : **General** 을 입력
   - Team: **MSFT** 을 선택   

    ![image](https://github.com/user-attachments/assets/10bb2866-aff5-4ea6-9396-42f859d71079)

# 2. 검색어 추출 

1. 트리거 하단 **+** -> **Add an action** 클릭

   ![image](https://github.com/user-attachments/assets/65833e69-ce96-48d6-9424-ee48d957dbe7)

2. **Microsoft Teams** 에서 **메세지 세부정보 가져오기** 선택

   ![image](https://github.com/user-attachments/assets/07ebb8d4-f48f-42bc-8292-1b26da2d4631)


3. 아래와 같이 입력합니다.

   메시지 : 번개 아이콘을 눌러 **키워드가 멘션될 때** 하위의 **메시지 ID**를 선택
   
   메시지 유형 : **채널** 선택

   팀 : **MSFT** 선택

   채널 : **General** 선택

   ![image](https://github.com/user-attachments/assets/a3abf4ae-6a20-48e2-8a6a-af63d2071e4c)


   입력을 완료하면, **for each** 가 자동으로 추가됩니다.

   ![image](https://github.com/user-attachments/assets/d8cafb69-1a2a-4c4e-b49f-b086d20809ea)







   


6. 하단에 **Get message details action** 추가 후, 다음과 같이 설정

![image](https://github.com/user-attachments/assets/517b82fc-fbd2-48c8-a6af-6e7b68b16a73)

<br>

![image](https://github.com/user-attachments/assets/d3167b39-f7f5-4052-b104-ca45d529a1af)

<br>

7. **Contidion** action 추가 후, 다음과 같이 설정

![image](https://github.com/user-attachments/assets/cfca05f9-91fd-4cf9-8f69-447399642bba)

<br>

![image](https://github.com/user-attachments/assets/ca53bfbe-7259-40ac-a712-9b79dd7b8752)

<br>

8. True 하단에 **Run a flow built with Power Automate for desktop (데스크톱용 Power Automate로 빌드된 흐름 실행)** action 추가 후, 다음과 같이 설정

<br>

- 가져온 본문 내용을 콜론(:) 문자를 기준으로 분할 후, 콜론(:) 뒷 부분을 데스크톱 흐름에 전달하기 위한 명령어 입력
```
last(split(outputs('Get_message_details')?['body/body/plainTextContent'], ':'))
```
### [설명]
```
Get_message_details라는 액션의 출력값에서<br>
body/body/plainTextContent (본문의 텍스트 내용) 을 가져와서,
문자열을 콜론(:) 문자를 기준으로 분할하여 배열로 반환 후,
배열의 마지막 항목을 가져옵니다.
```

![img2](https://github.com/user-attachments/assets/50f411ad-21b6-45bf-9290-62ff0ff1fb08)

![image](https://github.com/user-attachments/assets/4eb8c4c2-fffc-4e95-997a-f6d0616ca366)

<br>

9. 기존 action을 새롭게 추가한 desktop flow 호출 action 하단으로 이동

![image](https://github.com/user-attachments/assets/b12b2549-7ff8-492f-95e5-9369967275fc)

<br>

10. **Reply with a message in a channel action** 추가 후, 다음과 같이 설정

![image](https://github.com/user-attachments/assets/82382f57-b0a8-4327-b8cd-2d7f78cb8717)

<br>
<br>

# 클라우드 흐름 작업 순서 (sample)

1. Teams의 **general** 채널에 **news**라는 키워드를 본문에 포함한 게시물 등록 감지 
<br>
<br>

![image](https://github.com/user-attachments/assets/f896feff-7775-4319-8f58-42123dfef24b)

<br>

2. trigger를 통해 Cloud Flow실행 -> 네이버 뉴스 검색 후 완료 메시지 댓글 입력

![image](https://github.com/user-attachments/assets/a9f4345b-782c-466f-b0d8-96d082d87d2c)
<br>
<br>
<br>
<br>
<br>

