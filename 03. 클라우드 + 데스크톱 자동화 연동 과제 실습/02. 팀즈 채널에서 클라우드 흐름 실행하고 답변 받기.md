# 팀즈 채널에서 클라우드 흐름 실행하고 답변 받기

#### Teams 채널에서 키워드가 포함된 게시물 등록 확인되면, 클라우드 흐름이 실행됨.
#### 클라우드 흐름 내에서 데스크톱 흐름에 검색 키워드 전달 및 Teams로 완료 메시지 발송하는 Cloud Flow 만들기

<br> 

# 1. 트리거 변경

1. 기존 트리거 (Manually trigger a flow) 삭제 후, Add a trigger 클릭

   ![image](https://github.com/user-attachments/assets/8f6c8864-ade7-440e-a48b-27ec7cdfb40f)


2. 트리거 목록에서 **Microsoft Teams** 트리거 중에서 **키워드가 멘션될때**를  선택하여 트리거 추가

   ![image](https://github.com/user-attachments/assets/5a7127f1-0f47-4ee7-ae17-d29ea225b62b)

3. When Keywords are mentioned (키워드가 멘션될 때) 클릭 후, 왼편 패널의 각 항목별 값 입력
 
   - 검색할 키워드 : **news:** 를 입력 
   - 메세지 유형 : **Channel** 을 선택
   - 채널 : **General** 을 입력
   - Team: **MSFT** 을 선택   

    ![image](https://github.com/user-attachments/assets/10bb2866-aff5-4ea6-9396-42f859d71079)

# 2. 검색어 추출 

1. 트리거 하단 **+** -> **Add an action** 클릭

   ![image](https://github.com/user-attachments/assets/65833e69-ce96-48d6-9424-ee48d957dbe7)

2. **Microsoft Teams** 에서 **메세지 세부정보 가져오기** 선택

   ![image](https://github.com/user-attachments/assets/07ebb8d4-f48f-42bc-8292-1b26da2d4631)


3. 아래와 같이 입력합니다.

   메시지 : 번개 아이콘을 눌러 **키워드가 멘션될 때** 하위의 **메시지 ID**를 선택
   
   메시지 유형 : **채널** 선택

   팀 : **MSFT** 선택

   채널 : **General** 선택

   ![image](https://github.com/user-attachments/assets/a3abf4ae-6a20-48e2-8a6a-af63d2071e4c)


   입력을 완료하면, **for each** 가 자동으로 추가됩니다.<br/>
   (선택된 값의 유형에 따라 필요시, 자동으로 **for each** 가 추가됩니다.)

   ![image](https://github.com/user-attachments/assets/d8cafb69-1a2a-4c4e-b49f-b086d20809ea)


4. **메시지 세부 정보 가져오기** 아래에 **조건** 추가
   
    (메세지가 news로 시작된 경우에만 뉴스 검색을 수행하도록 조건을 설정합니다.)

    ![image](https://github.com/user-attachments/assets/1d35cf45-fbdf-4420-ab59-594232a710ba)

    조건에 **메시지 세부 정보 가져오기** 하위의 **본문** 을 추가하고, (3)에서 **starts with**를 선택, (4)에 news 를 입력합니다.
    
    ![image](https://github.com/user-attachments/assets/a61120fe-41cc-44d0-9423-3b2bf8261ed9)



5. **데스크톱용 Power Automate로 빌드된 흐름 실행** 과 **HTTP** 내의 검색어를 채널에서 받은 검색어로 변경한다.

아래와 같이 설정하거나 혹은 아래의 코드를 복사하여 붙여넣어도 됩니다.

```
@{last(split(outputs('메시지_세부_정보_가져오기')?['body/body/plainTextContent'],':'))}
```

   ![image](https://github.com/user-attachments/assets/c0aff247-c158-43c5-9f23-bfee5307a47b)


   ![image](https://github.com/user-attachments/assets/559ccbf7-f9b4-4c60-8932-d3a28d96bc16)


   

6. 하위의 흐름들을 마우스로 드래그하여  **조건** 내의 True 부분으로 이동합니다.

   ![image](https://github.com/user-attachments/assets/d14bd7ba-9cf9-407c-af62-49433bd63404)

   ![image](https://github.com/user-attachments/assets/5235e123-dfba-4733-b88b-343d4e7b6706)


# 3. 결과를 채널 메시지에 회신하기

1. **테이블에 행 추가** 상위의 **For each** 아래 **+** 를 클릭하여 **작업 추가**

    ![image](https://github.com/user-attachments/assets/8be93eab-5adc-484b-85df-74bb45fd98d7)

2. **채널에서 메시지와 함께 회신** 을 추가

    ![image](https://github.com/user-attachments/assets/c8891082-18f9-4e0a-a880-85460fac2e3d)


   ![image](https://github.com/user-attachments/assets/b9f12c9f-103b-41a5-918e-eb6ddcc2a523)


   ![image](https://github.com/user-attachments/assets/36195ce2-1650-4a6e-aad6-f136af0fb464)


   ![image](https://github.com/user-attachments/assets/c67adab8-cfe0-4c7f-9a97-a2ad6d32ea74)

   



# 4. 결과 확인 하기

팀즈를 열고, MSFT - 일반 채널에서 게시물을 등록합니다.
    
   ![image](https://github.com/user-attachments/assets/db84b2c6-6b16-432a-b00c-2c20f14a620b)

   ![image](https://github.com/user-attachments/assets/45a7ccb8-1cba-48c9-82e4-fcbafed27271)

   ![image](https://github.com/user-attachments/assets/6d3fb990-06ea-4e51-b17c-0f4b44f56d3c)

실행 기록 확인하기

   ![image](https://github.com/user-attachments/assets/d988a0b4-c882-4fab-b3e7-130dc8dac7c3)

   
   ![image](https://github.com/user-attachments/assets/7b2e2b70-b38f-4bd6-ad82-463c54084cbc)



